---
title: |
  Materials Genomics<br>
  Lecture 12: Generative Models for Materials
bibliography: ref.bib
# csl: custom.csl
author:
  - name: Prof. Dr. Philipp Pelz
    affiliation: 
      - FAU Erlangen-Nürnberg
      - Institute of Micro- and Nanostructure Research
   
execute: 
  eval: true
  echo: true
format: 
    revealjs: 
        chalkboard: true
        mermaid:
            theme: forest
        # mermaid-format: png
        # scroll-view:
        #     activate: true
        #     snap: mandatory
        #     layout: full 
        width: 1920
        height: 1080
        menu:
            side: right
            width: wide 
        template-partials:
            - title-slide.html
        css: custom.css
        theme: custom.scss
        slide-number: c/t    
        logo: "eclipse_logo_small.png"          
        highlight-style: a11y
        incremental: true 
        background-transition: fade
        footer: "©Philipp Pelz - FAU Erlangen-Nürnberg - Materials Genomics"
---
 
 


## Welcome

### Week 12 — Generative Models for Materials

**Goals for today:**

- Understand what generative models do in materials science  
- Learn the basics of VAEs and diffusion models for crystal generation  
- Discuss constraints: symmetry, stability, charge neutrality  
- Conceptually sample from a pretrained generative model and analyze validity  

---

## Outline

1. Why generative models for materials?  
2. Basics of VAEs for crystal generation  
3. Basics of diffusion models for crystal generation  
4. Constraints: symmetry, stability, charge neutrality  
5. Exercise: sampling from a pretrained model & validity checks  
6. Summary  

---

## 1. Why Generative Models for Materials?

So far:

- We used ML to **predict** properties of existing structures.  

Generative step:

- Use ML to **propose new structures**:
  - New compositions  
  - New crystal structures  
  - New local environments  

Goal:

- Navigate huge design space:
  - Suggest candidates likely to have desired properties  
  - Cover “missing” regions of materials space  

Generative models try to learn:

- The **distribution** of “realistic” materials  
- Then sample from it  

---

## Design Problem View

We want:

- Input: high-level design constraints (e.g. “wide band gap oxide perovskites”)  
- Output: candidate structures that are:
  - Chemically valid  
  - Symmetry-consistent  
  - Reasonably stable  

Generative models are one route toward this “materials imagination machine”.

---

## 2. VAEs — Variational Autoencoders for Materials

VAEs are **latent-variable generative models**.

Core components:

- **Encoder**: maps input structure → latent vector \(z\)  
- **Decoder**: maps \(z\) → reconstructed structure  
- Training adds **regularization** so \(z\) follows a simple distribution (usually Gaussian).  

After training:
- Sample \(z\) from prior (e.g. \(N(0, I)\))  
- Decode to generate new structures  

---

## VAEs: Conceptual Mechanics

1. Represent structure in some fixed way:
   - Composition vector  
   - Crystal graph (for graph-VAE)  
   - Lattice + fractional coordinates in a fixed-size format  

2. Encoder network:
   - Outputs mean and variance for latent vector \(z\)  

3. Sample \(z\) (reparameterization trick)  

4. Decoder network:
   - Produces reconstructed structure representation  

Loss:
- Reconstruction loss (structure similarity)  
- KL divergence between latent distribution and prior  

---

## VAEs for Materials

Design choices:

- Representation of crystal:
  - Grid-based (voxelized representation of atoms)  
  - Graph-based (nodes/edges with attributes)  
  - Composition + prototype + distortion parameters  

- Objective:
  
  - Reconstruct known materials structures  
  - Ensure latent space is smooth:
    - Interpolation in \(z\)-space → gradual structural changes  

VAEs give:
- Continuous latent space of materials  
- Ability to interpolate and sample new points  

---

## Pros & Cons of VAEs

Pros:

- Smooth latent space → interpolation & optimization  
- Relatively easy to train  
- Can combine with property predictors (conditional VAEs)  

Cons:

- Reconstructions can be blurry / imperfect  
- Hard to enforce discrete constraints (e.g. integer stoichiometries, charge balance)  
- Symmetry/stability constraints not guaranteed unless explicitly added  

---

## 3. Diffusion Models for Crystal Generation

Diffusion models:

- Start from noise  
- Learn to **reverse a diffusion process**, turning noise into a sample  

Two stages:

1. **Forward process**:
   - Gradually add noise to data until it becomes nearly random  

2. **Reverse process** (learned):
   - A neural network learns how to denoise step-by-step  

After training:

- Sample noise → apply learned reverse steps → generated structure  

---

## Diffusion for Materials

Key question: what do we diffuse?

Options:

- Atomic positions + types (continuous + categorical)  
- Graph structures (nodes, edges)  
- Lattice parameters  

Process:

- At each step, network predicts denoised structure (or noise)  
- Gradually refine toward realistic crystal  

Advantages:

- Very strong generative performance in images and molecules  
- Can generate diverse samples  

Challenges:

- Incorporating symmetry  
- Ensuring composition and charge neutrality  
- Handling periodic boundary conditions  

---

## VAEs vs Diffusion (Intuitively)

**VAE:**

- Single-step decode from latent vector  
- Easy to interpolate in latent space  
- Reconstructions can be coarse  

**Diffusion:**

- Multi-step refine-from-noise process  
- Typically high-quality samples  
- More complex and compute-heavy  

Both can be:

- Conditioned on composition or target properties  
- Combined with property predictors  
- Constrained by physics to varying degrees  

---

## 4. Constraints: Symmetry, Stability, Charge Neutrality

Generative models must respect **materials-specific constraints**, or they will generate nonsense.

---

## 4.1 Symmetry

Crystals have:

- Space group symmetry  
- Lattice periodicity  
- Wyckoff positions  

Generative models must:

- Either generate structures that can be symmetrized  
- Or operate directly in a **symmetry-aware representation**:
  - Generate lattice + Wyckoff positions + site occupancies  
  - Or work with graph representations that encode periodicity & symmetry  

Post-hoc:

- Use symmetry analysis (spglib) to:
  - Check space group  
  - Standardize cell  
  - Clean small distortions  

---

## 4.2 Stability

Generative model might:

- Propose structures that are wildly unstable  

We care about:
- Formation energy  
- Hull distance  

Strategies:

- Use DFT/ML surrogate to evaluate stability  
- Reject or down-weight unstable samples  
- Train generative model on stable/metastable materials only  

Closed-loop:

- Generate → evaluate (surrogate / DFT) → refine model or filter  

---

## 4.3 Charge Neutrality & Valence

Materials must satisfy:

- Charge neutrality  
- Realistic oxidation state combinations  

Generative model must:

- Respect composition constraints:
  - Fixed stoichiometry types (ABO₃, etc.)  
  - Elemental charge compatibility  

Strategies:

- Condition generation on valid composition templates  
- Use valence checks as a filter  
- Structural & chemical sanity checks (e.g., no highly improbable bonds)  

---

## Filter vs Enforce

Two philosophies:

- **Filter-based**: generate many candidates, then filter out invalid ones using rules and property models.  
- **Constraint-aware generation**: build symmetry/valence/charge neutrality into the architecture or sampling scheme.  

In practice:

- Combinations of both are used.

---

## 5. Exercise: Sample a Generative Model & Analyze Validity

We won’t train a huge VAE or diffusion model in class, but we can:

- Use a **pretrained** model (conceptually)  
- Or a shared dataset of generated structures  
- Analyze **how valid** the generated materials are  

---

## Step 1 — Obtain Generated Samples

Assume:

- We have access to a set of generated crystals:
  - Lattice parameters  
  - Atomic positions  
  - Element types  

From:

- A pretrained VAE / diffusion model  
- Or from a public repository / instructor-provided file  

**PYTHONHERE**

Conceptual loading of:
- `generated_structures`  

---

## Step 2 — Basic Structural Sanity Checks

For each generated structure:

1. Lattice:
   - Non-zero cell volume  
   - Not wildly skewed or degenerate  
   - Reasonable cell lengths / angles  

2. Minimum interatomic distances:
   - No unphysically short distances  

3. Composition:
   - Reasonable stoichiometry  
   - Charge neutrality (if ionic)  

**PYTHONHERE**

These simple checks already eliminate many obviously unphysical samples.

---

## Step 3 — Symmetry Analysis

Use spglib / pymatgen:

For each surviving structure:

- Find space group  
- Standardize the cell  
- Identify Wyckoff positions  

Questions:

- Does the model generate crystals that fall into familiar space groups?  
- Are there weird low-symmetry distortions of high-symmetry prototypes?  

**PYTHONHERE**

---

## Step 4 — Approximate Stability Assessment

Use:

- A surrogate model (e.g., pre-trained formation energy predictor)  
- or a simple heuristic like:
  - Compare to known structures in databases  

Conceptually:

- Compute predicted formation energy or hull distance for each structure  
- Classify as:
  - “Likely stable/metastable”  
  - “Likely unstable”  

**PYTHONHERE**

---

## Step 5 — Quantify Validity

Define simple metrics:

- Fraction that pass basic structural sanity checks  
- Fraction that have recognizable space groups  
- Fraction predicted within some stability window (e.g. hull distance < 0.1 eV/atom)  

Discuss:

- How often does the generative model produce plausible candidates?  
- Does conditioning on composition improve validity?  
- Do we see mostly perturbations of known prototypes or genuinely new motifs?  

---

## 6. Summary

**Today you learned:**

- What generative models (VAEs, diffusion models) try to do in materials science  
- How VAEs create a continuous latent space for structures  
- How diffusion models iteratively denoise from random noise to a crystal  
- Why domain-specific constraints (symmetry, stability, charge neutrality) are crucial  
- How to evaluate the validity of generated structures using:
  - Structural sanity checks  
  - Symmetry analysis  
  - Stability estimates  

This closes **Unit IV — Learning Properties from Atomic Structure** and opens the door to:
- **Inverse design**,  
- **Active learning**,  
- and **closed-loop autonomous discovery**.

---

## Questions?

Use the chalkboard!


<div>
<script>
document.getElementById("marimo-frame").onload = function() {
    try {
        let iframeDoc = document.getElementById("marimo-frame").contentWindow.document;
        let marimoBadge = iframeDoc.querySelector("div.fixed.bottom-0.right-0.z-50");
        if (marimoBadge) {
            marimoBadge.style.display = "none";
            console.log("Marimo badge hidden successfully.");
        } else {
            console.log("Badge not found.");
        }
    } catch (error) {
        console.warn("Unable to modify iframe content due to CORS restrictions.");
    }
};
</script>
</div>