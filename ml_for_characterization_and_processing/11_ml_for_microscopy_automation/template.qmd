---
title: |
  ML for Characterization and Processing<br>
  Lecture 11: ML for Microscopy Automation
bibliography: ref.bib
# csl: custom.csl
author:
  - name: Prof. Dr. Philipp Pelz
    affiliation: 
      - FAU Erlangen-Nürnberg
      - Institute of Micro- and Nanostructure Research
   
execute: 
  eval: true
  echo: true
format: 
    revealjs: 
        chalkboard: true
        mermaid:
            theme: forest
        # mermaid-format: png
        # scroll-view:
        #     activate: true
        #     snap: mandatory
        #     layout: full 
        width: 1920
        height: 1080
        menu:
            side: right
            width: wide 
        template-partials:
            - title-slide.html
        css: custom.css
        theme: custom.scss
        slide-number: c/t    
        logo: "eclipse_logo_small.png"          
        highlight-style: a11y
        incremental: true 
        background-transition: fade
        footer: "©Philipp Pelz - FAU Erlangen-Nürnberg - ML for Characterization and Processing"
---
 

## Welcome

### Week 11 — ML for Microscopy Automation

**Goals for today:**
- Learn how ML drives microscope control  
- Autofocusing with ML  
- Drift detection & correction  
- Parameter selection & adaptive acquisition  
- Vision-based defect detection in EBSD/TEM  

---

## Outline

1. What is microscopy automation?  
2. ML for autofocus  
3. Drift detection & correction  
4. Parameter selection  
5. Vision-based defect detection  
6. Summary  

---

## 1. What Is Microscopy Automation?

Modern microscopes are:

- Computer-programmable  
- Equipped with feedback sensors  
- Capable of real-time imaging  
- Highly tunable (exposure, focus, beam current…)  
- Integrated with vision-based pipelines  

Automation goals:

- Higher throughput  
- Better reproducibility  
- Reduced operator workload  
- Reliable long acquisitions  
- “Self-driving microscopes”

ML acts as the decision layer.

---

## Automation in Context

Examples:

- SEM: auto-focus, auto-contrast, adaptive dwell  
- TEM: live drift correction, autofocus, defocus tuning  
- EBSD: adaptive step size, quality gating  
- EDS/EELS: smart-dose allocation  
- 4D-STEM: adaptive scanning & pattern QC  

Automation = optimization + perception.

---

## 2. Autofocusing with ML

### Why autofocus matters:

- Drift changes focus  
- Sample tilt changes focus  
- Charging effects blur images  
- Low-dose imaging limits manual focusing  

Traditional focus metrics:

- Laplacian variance  
- Tenengrad  
- FFT high-frequency energy  
- Gradient histogram  

These can fail for:

- Low SNR  
- TEM phase contrast  
- Dull EBSD patterns  
- Samples with strong periodicity

---

### ML Autofocus

Approaches:

- CNN to predict “focus score”  
- Regression model: image → focus offset  
- Contrastive learning on well/poorly focused images  
- Reinforcement learning that adjusts focus knob  

Benefits:

- Learns domain-specific contrast rules  
- Faster convergence  
- Robust across detectors  
- Less sensitive to noise  

---

## Autofocus Pipeline

1. Acquire frame  
2. ML model estimates focus quality  
3. Adjust lens current  
4. Iterate until maximum score  

Example placeholder:

**PYTHONHERE**

---

## 3. Drift Detection & Correction

Long acquisitions (tomography, 4D-STEM, EBSD maps) suffer from drift.

### Drift sources:

- Thermal drift  
- Charging  
- Piezo creep  
- Mechanical vibrations  
- Magnetic lens heating  

Classical correction:
- Cross-correlation  
- Template matching  
- Fiducial tracking  

Limitations:
- Low SNR images  
- Non-linear drift  
- Local distortions  

---

## ML Drift Correction

Methods:

- CNN-based alignment  
- Optical flow models  
- RNN drift trajectory prediction  
- Differentiable registration networks  

Benefits:

- Handles non-rigid drift  
- Predicts drift before it becomes severe  
- Enables real-time compensation  

---

## Drift-Aware Acquisition

Microscope can:

- Pause scanning if drift > threshold  
- Lower scan speed  
- Trigger recalibration  
- Re-scan corrupted regions  

ML monitors image quality continuously.

---

## 4. Parameter Selection / Adaptive Acquisition

Microscopes have many controllable parameters:

- Exposure time  
- Dwell time  
- Beam current  
- Acceleration voltage  
- Aperture choice  
- Camera length  
- Step size (EBSD)  
- Convergence angle (STEM)  

Manual tuning is slow and inconsistent.

---

## ML for Parameter Optimization

Techniques:

- Bayesian optimization  
- Gaussian Process surrogate modeling  
- Genetic algorithms  
- Reinforcement learning agents  

Applications:

- SEM: optimal dwell time for SNR target  
- TEM: choose camera length for desired diffraction contrast  
- EBSD: adaptive step size to optimize throughput  
- EDS: choose dwell time per pixel via uncertainty  

---

## Adaptive (“Smart”) Acquisition

Microscope decides *where* and *how* to scan:

- Increase dose in high-interest regions  
- Reduce dose in beam-sensitive areas  
- Adaptive raster refinement  
- Skip uniform regions  
- Predictively re-scan areas with defects  

Outcome:
- Higher quality  
- Lower dose  
- Faster acquisition  

---

## 5. Vision-Based Defect Detection (EBSD & TEM)

Automation requires quality assurance.

### Defects in EBSD:
- Indexing failures  
- Low pattern quality  
- Noise/charging  
- Drift-induced smearing  
- Detector saturation  

ML detects:

- Out-of-distribution patterns  
- Unindexable regions  
- Grain boundary overlaps  
- Beam damage indicators  

---

### ML Models for EBSD Defects

- CNN classification of pattern quality  
- Autoencoder anomaly detection  
- Transformer-based EBSD pattern embedding  
- Clustering to detect problematic regions  

Uses:

- Adaptive step size  
- Reacquire bad points  
- Flag regions for human review  

---

## Vision-Based Defects in TEM

TEM defect types:

- Contamination  
- Blurred images  
- Diffraction artifacts  
- Charging  
- Drift streaks  
- Thickness changes  

ML detects:

- Motion blur  
- Dirt/contamination patches  
- Satellites/reflections  
- Beam degradation  
- Out-of-focus frames  

Useful for:

- In-situ TEM  
- Tomography  
- Automated screening  
- 4D-STEM quality control  

---

## ML Defect Detection Pipeline

1. Acquire frame  
2. Preprocess (normalize, crop)  
3. ML model: classifier or anomaly detector  
4. Decide: keep / discard / re-acquire / adjust parameters  
5. Log & update microscope state  

Placeholder:

**PYTHONHERE**

---

## 6. Summary

### Key insights:
- ML enables real-time microscope *control*, not just analysis  
- Autofocus becomes robust via learned contrast patterns  
- Drift correction can be predictive, not reactive  
- ML tunes parameters and optimizes beam/time usage  
- Vision-based defect detection ensures data quality  
- Together: **toward self-driving SEM/TEM/EBSD systems**

Next week:  
**Week 12 — Closed-Loop Experiments & Multi-Modal Automation**

---

## Questions?

Use the chalkboard!


<div>
<script>
document.getElementById("marimo-frame").onload = function() {
    try {
        let iframeDoc = document.getElementById("marimo-frame").contentWindow.document;
        let marimoBadge = iframeDoc.querySelector("div.fixed.bottom-0.right-0.z-50");
        if (marimoBadge) {
            marimoBadge.style.display = "none";
            console.log("Marimo badge hidden successfully.");
        } else {
            console.log("Badge not found.");
        }
    } catch (error) {
        console.warn("Unable to modify iframe content due to CORS restrictions.");
    }
};
</script>
</div>